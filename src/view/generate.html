<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>GPT CoBuilder</title>
    <link rel="stylesheet" href="generate.css" />
  </head>
  <body>
    <!-- Input field for ChatGPT API key -->
    <label for="api-key">ChatGPT API Key:</label>
    <input type="text" id="api-key" />

    <!-- Input field for folder selection -->
    <label for="folder-selection">Select a Folder:</label>
    <input type="file" id="folder-selection" directory webkitdirectory />

    <!-- Element to display the file structure -->
    <pre id="file-structure"></pre>

    <div>Tips: 1. Sometimes less is more, sometimes you need to add more context</div>

    <!-- Textarea for project description -->
    <label for="project-description">Project Description:</label>
    <textarea id="project-description" rows="5">This is an electron project that aims to let users quickly create and iterate on applications.</textarea>

    <!-- Input field for system message -->
    <label for="system-message">System Message:</label>
    <textarea id="system-message" rows="5" >You are a good programmer and you should do your best to suggest complete code changes to achieve the users goal. 

Suggest changes to the right files. If you need to change multiple files, include which code belongs in which file.</textarea>

    <!-- Div for generated message -->
    <div>
      <label for="generated-message">Generated Message:</label>
      <textarea id="generated-message" class="generated-message" rows="20" disabled></textarea>
    </div>

    <!-- Input field for user message -->
    <label for="user-message">User Message:</label>
    <textarea id="user-message" rows="5" ></textarea>

    <!-- Div for full message -->
    <div>
      <label for="full-message">Full Message:</label>
      <textarea id="full-message" class="full-message" rows="20" disabled></textarea>
    </div>
        
    <!-- Total tokens count -->
    <div id="token-count"></div>

    <!-- Button to trigger GPT completion -->
    <button class="button" id="generate-button">Generate GPT Completion</button>

    <!-- Element to display errors -->
    <div id="error-log"></div>

    <!-- Total tokens count -->
    <div id="response-token-count"></div>

    <!-- Input field for user message -->
    <label for="server-response">Model response:</label>
    <div id="server-response" rows="5" disabled></div>

    <script src="generate.js"></script>
    <script>
      // Attach event listener to the button
      const generateButton = document.getElementById('generate-button');
      const errorLog = document.getElementById('error-log');

      function clearErrorLog() {
        errorLog.textContent = "";
      }

      const userMessage = 'Hello, how can you help me?';
      generateButton.addEventListener('click', () => {
        generateButton.disabled = true; // Disable the button
        sendMessageToChatGPT()
        .then(response => {
          console.log('Assistant:', response);
          // Do something with the assistant's response
          generateButton.disabled = false; // Re-enable the button after receiving the response
          clearErrorLog(); // Clear the error log
          displayAssistantResponse(response); // Display the assistant's response
        })
        .catch(error => {
          errorLog.textContent = `Error: ${error.message}`;
          generateButton.disabled = false; // Re-enable the button after an error occurs
        });
      });
    </script>
  </body>
</html>
